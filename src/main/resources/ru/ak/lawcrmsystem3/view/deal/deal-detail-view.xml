<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<view xmlns="http://jmix.io/schema/flowui/view"
      title="msg://dealDetailView.title"
      focusComponent="form">
    <data>
        <instance id="dealDc"
                  class="ru.ak.lawcrmsystem3.entity.Deal">
            <fetchPlan extends="_base">
                <property name="servicesRendered" fetchPlan="_base"/>
                <property name="clients" fetchPlan="_base"/>
                <property name="responsibleLawyer" fetchPlan="_base"/>
                <property name="relatedDocuments" fetchPlan="_base"/>
                <property name="dealParticipants" fetchPlan="_base"/>
                <property name="tasks" fetchPlan="_base"/> </fetchPlan>
            <loader id="dealDl"/>
            <collection id="clientsDc" property="clients"/>
            <collection id="responsibleLawyerDc" property="responsibleLawyer"/>
            <collection id="dealParticipantsDc" property="dealParticipants"/>
            <collection id="relatedDocumentsDc" property="relatedDocuments"/>
            <collection id="tasksDc" property="tasks"/> </instance>
    </data>
    <facets>
        <dataLoadCoordinator auto="true"/>
    </facets>
    <actions>
        <action id="saveAction" type="detail_saveClose"/>
        <action id="closeAction" type="detail_close"/>
    </actions>
    <layout>
        <formLayout id="form" dataContainer="dealDc">
            <responsiveSteps>
                <responsiveStep minWidth="0" columns="1"/>
                <responsiveStep minWidth="40em" columns="2"/>
            </responsiveSteps>
            <textField id="titleField" property="title"/>
            <textField id="dealNumberField" property="dealNumber"/>
            <dateTimePicker id="startedAtField" property="startedAt"/>
            <dateTimePicker id="finishedAtField" property="finishedAt"/>
            <textField id="descriptionField" property="description"/>
            <select id="dealStatusField" property="dealStatus"/>
        </formLayout>

        <h4 text="msg://ru.ak.lawcrmsystem3.entity/Deal.clients"/>
        <hbox id="buttonsPanel1" classNames="buttons-panel">
            <button action="clientsDataGrid.addAction"/>
            <button action="clientsDataGrid.excludeAction"/>
        </hbox>
        <dataGrid id="clientsDataGrid" dataContainer="clientsDc" width="100%" minHeight="20em">
            <actions>
                <action id="addAction" type="list_add"/>
                <action id="excludeAction" type="list_exclude"/>
            </actions>
            <columns>
                <column property="name"/>
                <column property="address"/>
                <column property="email"/>
                <column property="phoneNumber"/>
                <column property="otherInfo"/>
                <column property="clientCategory"/>
                <column property="clientStatus"/>
            </columns>
        </dataGrid>

        <h4 text="msg://ru.ak.lawcrmsystem3.entity/Deal.responsibleLawyer"/>
        <hbox id="buttonsPanel2" classNames="buttons-panel">
            <button action="responsibleLawyerDataGrid.addAction"/>
            <button action="responsibleLawyerDataGrid.excludeAction"/>
        </hbox>
        <dataGrid id="responsibleLawyerDataGrid" dataContainer="responsibleLawyerDc" width="100%" minHeight="20em">
            <actions>
                <action id="addAction" type="list_add"/>
                <action id="excludeAction" type="list_exclude"/>
            </actions>
            <columns>
                <column property="firstName"/>
                <column property="lastName"/>
                <column property="username"/>
                <column property="email"/>
                <column property="active"/>
                <column property="timeZoneId"/>
            </columns>
        </dataGrid>

        <h4 text="msg://ru.ak.lawcrmsystem3.entity/Deal.dealParticipants"/>
        <hbox id="buttonsPanel3" classNames="buttons-panel">
            <button action="dealParticipantsDataGrid.addAction"/>
            <button action="dealParticipantsDataGrid.excludeAction"/>
        </hbox>
        <dataGrid id="dealParticipantsDataGrid" dataContainer="dealParticipantsDc" width="100%" minHeight="20em">
            <actions>
                <action id="addAction" type="list_add"/>
                <action id="excludeAction" type="list_exclude"/>
            </actions>
            <columns>
                <column property="uniqueNumber"/>
                <column property="titleOrName"/>
                <column property="otherInfo"/>
                <column property="address"/>
                <column property="participantStatus"/>
            </columns>
        </dataGrid>

        <h4 text="msg://ru.ak.lawcrmsystem3.entity/Deal.relatedDocuments"/>
        <hbox id="buttonsPanel4" classNames="buttons-panel">
            <button action="relatedDocumentsDataGrid.addAction"/>
            <button action="relatedDocumentsDataGrid.excludeAction"/>
        </hbox>
        <dataGrid id="relatedDocumentsDataGrid" dataContainer="relatedDocumentsDc" width="100%" minHeight="20em">
            <actions>
                <action id="addAction" type="list_add"/>
                <action id="excludeAction" type="list_exclude"/>
            </actions>
            <columns>
                <column property="mimeType"/>
                <column property="createdBy"/>
                <column property="createdDate"/>
            </columns>
        </dataGrid>

        <h4 text="msg://ru.ak.lawcrmsystem3.entity/Deal.tasks"/>
        <hbox id="tasksButtonsPanel" classNames="buttons-panel">
            <button action="tasksDataGrid.addAction"/>
            <button action="tasksDataGrid.excludeAction"/>
        </hbox>
        <dataGrid id="tasksDataGrid" dataContainer="tasksDc" width="100%" minHeight="20em">
            <actions>
                <action id="addAction" type="list_add"/>
                <action id="excludeAction" type="list_exclude"/>
            </actions>
            <columns>
                <column property="taskTitle"/>
                <column property="deadline"/>
                <column property="taskStatus"/>
                <column property="taskPriority"/>
            </columns>
        </dataGrid>

        <hbox id="dealStageButtons" classNames="buttons-panel">
            <button id="viewDealStagesBtn" text="Посмотреть/Добавить стадии движения дела"/>
        </hbox>

        <hbox id="detailActions">
            <button id="saveAndCloseButton" action="saveAction"/>
            <button id="closeButton" action="closeAction"/>
        </hbox>
    </layout>
</view>
